"""
ç¬¬325å›æ—¥æœ¬ä½“è‚²å¤§å­¦é•·è·é›¢ç«¶æŠ€ä¼šã®ãƒ†ã‚¹ãƒˆé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
ç”·å­5000m 1çµ„ã€ç”·å­10000m 1-3çµ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
"""
import os
import sys

import django

# Djangoè¨­å®š
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'nitsys.settings')
django.setup()

from datetime import date

from django.db import transaction

from accounts.models import Athlete, Organization, User
from competitions.models import Competition, Race
from entries.models import Entry
from heats.models import Heat, HeatAssignment

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: (é¸æ‰‹å, æ‰€å±, è¨˜éŒ²/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹)
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'DNS' = æ¬ å ´, 'DNF' = é€”ä¸­æ£„æ¨©, ãã‚Œä»¥å¤–ã¯ã‚¿ã‚¤ãƒ 

RACE_RESULTS = {
    'ç”·å­5000m': {
        1: [  # 1çµ„
            ('å®®å‚ å’Œæ¨¹', 'æ±äº¬é™¸å”', '15:35.85'),
            ('ç”°ä¸­ ç›´æ¨¹', 'Hondaæ ƒæœ¨', '15:37.87'),
            ('ä¸Šç”° èª æ–—', 'ç”²æ–å¸‚é™¸å”', '15:38.48'),
            ('å³°å°¾ é¼', 'ç¥å¥ˆå·å¤§', '15:38.88'),
            ('ç§‹æœ¬ ä¸ˆç‘ ', 'æ „å…‰å­¦åœ’é«˜', '15:39.58'),
            ('é»’å²© å®˜ä¹éƒ', 'æ±è¾²å¤§äºŒé«˜', '15:40.57'),
            ('æ¨ªå±± ç¨€ä¸€', 'èç”°é«˜', '15:43.64'),
            ('è¥¿å†… æ‚ è¨˜', 'èç”°é«˜', '15:43.75'),
            ('å“å· å¤¢ç¿”', 'æ³•æ”¿å¤§å­¦ç¬¬äºŒä½“è‚²ä¼š', '15:45.83'),
            ('æ¨‹å£ è‚‡', 'æ±è¾²å¤§äºŒé«˜', '15:48.98'),
            ('èŒ‚æœ¨ ç³', 'åŸè¥¿å¤§åŸè¥¿é«˜', '15:54.93'),
            ('å®®å‚ ç›´æ¨¹', 'æ±äº¬é™¸å”', '15:55.39'),
            ('è°·å£ è‘µ', 'å¸¸è‘‰å¤§èŠå·é«˜', '15:57.25'),
            ('å¾Œé–‘ ç’ƒå¤®å¸Œ', 'æ±è¾²å¤§äºŒé«˜', '15:58.90'),
            ('æ¢…ç”° çœŸç‘³å¼¥', 'æ˜æ²»å¤§å­¦é™¸ä¸Šç«¶æŠ€åŒå¥½ä¼š', '16:11.06'),
            ('å¤§æ‰ çœŸäºº', 'å¤§æ±å¤§ä¸€é«˜', '16:23.62'),
            ('æµ¦æ±  æµ·æ–—', 'æ±äº¬éƒ½å¸‚å¤§', '16:27.68'),
            ('å¤§å¹³ ä½³ç¥', 'é•·å²¡é«˜å°‚', '16:29.89'),
            ('é˜¿éƒ¨ æµ·æ–—', 'æ±è¾²å¤§äºŒé«˜', '16:30.53'),
            ('èŒ‚å†… æ‹“è¦–', 'å¤§é¤¨é³³é³´é«˜', '16:30.68'),
            ('ç‰§ è€€ç¥', 'é¹¿å±‹ä½“è‚²å¤§', '16:32.50'),
            ('å®¿é‡éƒ¨ å‹å“‰', 'èç”°é«˜', '16:38.87'),
            ('ç”ºç”° æ‹“æµ·', 'åŸè¥¿å¤§åŸè¥¿é«˜', '16:39.20'),
            ('å°é«˜ æ•ä¹Ÿ', 'BACKNEXT', '16:46.14'),
            ('å ¤ ç…Œ', 'æ±è¾²å¤§äºŒé«˜', '17:02.11'),
            ('åŠæˆ¸ ç‰å“‰', 'æ–°æ½Ÿé™¸å”', '17:10.16'),
            ('æœ¬å¤š å®Ÿåˆ©', 'å±±æ¢¨å¤§', '17:22.79'),
            ('è—¤ç”° æƒ‡ä¹Ÿ', 'å¤§é¤¨é³³é³´é«˜', '17:23.99'),
            ('å°¾å´ ä»', 'èç”°é«˜', '17:32.58'),
            ('é«˜æ©‹ å­æ¨¹', 'ç‰å·å¤§', '17:46.13'),
            ('ç¾½æ²¢ ç‰é£›', 'å¤§é¤¨é³³é³´é«˜', '18:47.17'),
            ('èµ¤æ¾¤ æ²»å¼¥', 'æ…¶æ‡‰ç¾©å¡¾å¤§', 'DNF'),
            ('é…’äº• å®æ¨¹', 'è—¤æ²¢å¸‚é™¸å”', 'DNF'),
            ('å°æ— æœ‹ä¹Ÿ', 'æ „å…‰å­¦åœ’é«˜', 'DNS'),
            ('ç¬¹æ£® ç‰ä»', 'å¤§é¤¨é³³é³´é«˜', 'DNS'),
            ('é™¶ å¤§ç‘œ', 'LUMINOUS TC', 'DNS'),
            ('å²¡ç”° æ‚ æ¥', 'æ „å…‰å­¦åœ’é«˜', 'DNS'),
            ('æ¡‘é‡ åº·æ˜Ÿ', 'æ˜æ²»å›½éš›åŒ»ç™‚å¤§', 'DNS'),
            ('ç”°ä¸­ ç‰ä¹‹ä»‹', 'èˆ¹æ©‹å¸‚æ¶ˆé˜²å±€', 'DNS'),
            ('åƒè‘‰ è™¹æ–—', 'è–å’Œå­¦åœ’é«˜', 'DNS'),
            ('åŒ—åŸ ç¨œå¤§', 'è–å’Œå­¦åœ’é«˜', 'DNS'),
            ('è—¤äº• é¢¯çœŸ', 'èç”°é«˜', 'DNS'),
            ('é¢¨ç¥­ å¤§å’Œ', 'èç”°é«˜', 'DNS'),
            ('æºå£ å¤§å’Œ', 'æ±è¾²å¤§äºŒé«˜', 'DNS'),
            ('æ¸…æ°´ é¥è²´', 'å¤§æ±å¤§ä¸€é«˜', 'DNS'),
        ],
    },
    'ç”·å­10000m': {
        1: [  # 1çµ„
            ('è—¤äº• é™½å¹³', 'ä¸­å¤®å­¦é™¢å¤§', '30:01.72'),
            ('æŸ± æ¬½ä¹Ÿ', 'è­¦è¦–åº', '30:04.30'),
            ('å±±ç”° æ¹Šä¹Ÿ', 'éº—æ¾¤å¤§', '30:18.23'),
            ('å±±å£ äº†ç”Ÿ', 'æ—¥æœ¬è–¬ç§‘å¤§', '30:18.42'),
            ('æ¿µå£ èª å¤ª', 'é–¢æ±å­¦é™¢å¤§', '30:19.11'),
            ('æ±Ÿå£ èª æ‚Ÿ', 'æ—¥æœ¬è–¬ç§‘å¤§', '30:25.95'),
            ('å†…ç”° æ‹“å¸Œ', 'SHONANRUNS', '30:27.76'),
            ('æ£® å•“å¿—éƒ', 'æ­¦è”µé‡å­¦é™¢å¤§', '30:29.72'),
            ('ä¸­å°¾ æ™Ÿçš', 'æ­¦è”µé‡å­¦é™¢å¤§', '30:35.06'),
            ('å‰ç”° æ‹“å“‰', 'æœ­å¹Œå±±ã®æ‰‹é«˜', '30:45.28'),
            ('ç•‘å±± å¤§çŸ¥', 'ç­‘æ³¢å¤§', '31:02.96'),
            ('å±±å´ é–‹åœ°', 'æ±äº¬çµŒæ¸ˆå¤§', '31:07.05'),
            ('é ˆå´ è£•ä¹Ÿ', 'å·å´å¸‚å½¹æ‰€', '31:09.09'),
            ('ä¸­é‡Œ æ¸©æ˜', 'æ±äº¬çµŒæ¸ˆå¤§', '31:09.72'),
            ('å¤§å € é™½å£«', 'å¸äº¬å¤§', '31:11.55'),
            ('ç”°åŸ æ»‰å·±', 'å¤§é˜ªé™¸å”', '31:14.76'),
            ('å¯Œå¼µ è£•ç´€', 'ç¥å¥ˆå·ï¾ï½½ï¾€ï½°ï½½ï¾', '31:16.39'),
            ('å°ç•‘ ç‘è²´', 'æœ­å¹Œå±±ã®æ‰‹é«˜', '31:18.06'),
            ('å € æ¥“çœŸ', 'æ­¦è”µé‡å­¦é™¢å¤§', '31:20.30'),
            ('ä¹…ä¿ äº®å¤ª', 'ä¸­å¤®å­¦é™¢å¤§', '31:25.32'),
            ('å±±å½¢ é™¸æ–—', 'é–¢æ±å­¦é™¢å¤§', '31:26.42'),
            ('ä½è—¤ è£•å¤ª', 'ï½»ï½³ï¾™ï½½ï½¼ï¾ï½¬ï¾Šï¾Ÿï¾', '31:37.31'),
            ('è‹¥æœˆ æ¶¼çœŸ', 'æ˜æ²»å­¦é™¢å¤§', '32:07.40'),
            ('æ‘ç”° ä¼Šå¹', 'æœ­å¹Œå±±ã®æ‰‹é«˜', '32:11.93'),
            ('å’Œä¹…æ´¥ å‹æœ', 'ä¿¡å·å¤§', '32:18.93'),
            ('æ¾¤æ‘ å„ªä»', 'æœ­å¹Œå­¦é™¢å¤§', '32:33.73'),
            ('ç£¯é‚‰ å‡Œæ±°', 'æœ­å¹Œå­¦é™¢å¤§', '32:34.85'),
            ('å¶‹å´ æ•¬å¤ª', 'é’æ¢…å¸‚å½¹æ‰€', '32:46.46'),
            ('ä½è—¤ å…‰æ•', 'é›»æ°—é€šä¿¡å¤§', '32:50.68'),
            ('å±±ä¸‹ å“²å²', 'äº¬éƒ½é™¸å”', '32:55.14'),
            ('ç«¹ç”° åŒ å¾', 'æœ­å¹Œå±±ã®æ‰‹é«˜', '33:09.61'),
            ('æ›½æˆ‘ æ‹“æ‘©', 'è‡³å­¦é¤¨å¤§', '33:17.90'),
            ('ä¼Šè—¤ è£•ä¸–', 'RDC RUN CLUB', '33:19.01'),
            ('è—¤åŸ å…‰ä¸€éƒ', 'è‡³å­¦é¤¨å¤§', '33:30.92'),
            ('é«™æ ¹ æ‚ å¸Œ', 'ç¥æ –TC', 'DNF'),
            ('èŸ¹æ±Ÿ é”æ¨¹', 'å·è¶Šå¸‚é™¸å”', 'DNF'),
            ('é¹¿å³¶ å…‰å¹³', 'OMIï½¶ï¾ï¾Šï¾Ÿï¾†ï½°', 'DNS'),
            ('ç™½çŸ³ é”ä¹Ÿ', 'çŸ³äº•ä½“å”', 'DNS'),
            ('èŠæ±  å’Œå“‰', 'å¥¥å·å¸‚é™¸å”', 'DNS'),
            ('å† è¡¡', 'æ±äº¬ç”°å¾‘å”æœƒ', 'DNS'),
            ('å¤å· å‰µå¤§', 'æœ­å¹Œå±±ã®æ‰‹é«˜', 'DNS'),
            ('ç”°é‡ æœé™½', 'æœ­å¹Œå­¦é™¢å¤§', 'DNS'),
            ('æµ¦ç”° èª‰äºº', 'æœ­å¹Œå±±ã®æ‰‹é«˜', 'DNS'),
            ('é¦¬æ¸¡ å…‰è–', 'é–¢æ±å­¦é™¢å¤§', 'DNS'),
        ],
        2: [  # 2çµ„
            ('ä¼šç”° æ˜Šç”Ÿ', 'ä¸Šæ­¦å¤§', '29:39.12'),
            ('å°¾å³¶ æ¨¹', 'ä¸Šæ­¦å¤§', '29:43.63'),
            ('å‡ºæ°´ æ„›ç¿”', 'ç¬¬ä¸€å·¥ç§‘å¤§', '29:47.30'),
            ('èŒ‚æœ¨ å„ªæ–—', 'ä¸Šæ­¦å¤§', '29:48.06'),
            ('é¦¬å ´ ï½±ï¾ï½¼ï¾ï½ªï¾›å…‰', 'æ±æ´‹å¤§', '29:48.80'),
            ('ç• æ­©å¤¢', 'åŸ¼ç‰åŒ»ç§‘å¤§å­¦G', '29:49.23'),
            ('è—¤æœ¬ é§¿ä¸–', 'æ±æ´‹å¤§', '29:49.56'),
            ('æ¸…æ°´ å´šæ±°', 'ã‹ã‚‰ã£é¢¨', '29:54.25'),
            ('å·è¶Š æˆè²´', 'æ­¦è”µé‡å­¦é™¢å¤§', '30:03.79'),
            ('æ›½æ ¹ ç›´ä¹Ÿ', 'æ±äº¬çµŒæ¸ˆå¤§', '30:05.10'),
            ('æµ·æ´¥ é”ä¹Ÿ', 'è­¦è¦–åº', '30:13.23'),
            ('æ¦æœ¬ å¤§ä¿®', 'æ±äº¬æ¶ˆé˜²åº', '30:13.75'),
            ('ä»Šé‡ æŸšè€€', 'ä¸Šæ­¦å¤§', '30:13.76'),
            ('å°åœ’ ç«œæˆ', 'æ±æ´‹å¤§', '30:14.43'),
            ('éˆ´æœ¨ è–ä¹Ÿ', 'ä¸Šæ­¦å¤§', '30:17.96'),
            ('å‰æ°¸ æ­©', 'ä¸Šæ­¦å¤§', '30:21.27'),
            ('ç¨²æœ¨ ç¥äºº', 'ä¸Šæ­¦å¤§', '30:30.35'),
            ('æµ…é‡ ç¨œå¤ª', 'åå¤å±‹å¤§', '30:30.59'),
            ('å¤§åŸ çˆ½ç”Ÿ', 'æ—¥æœ¬è–¬ç§‘å¤§', '30:33.15'),
            ('ç·‘å· èˆª', 'é–¢æ±å­¦é™¢å¤§', '30:36.61'),
            ('è§’å· å¤¢æœ‰äºº', 'æ±äº¬å›½éš›å¤§', '30:54.86'),
            ('å±±æœ¬ é§¿ä¹‹ä»‹', 'ä¸Šæ­¦å¤§', '30:56.62'),
            ('é–¢æœ¬ æ•¬å¤ª', 'ä¸Šæ­¦å¤§', '31:05.38'),
            ('ç”°æ²¼ çŸ¥æ¨¹', 'æœ­å¹Œå­¦é™¢å¤§', '31:10.93'),
            ('éˆ´æœ¨ é™½é“', 'ä¸Šæ­¦å¤§', '31:14.89'),
            ('å°é‡ é€', 'æ³•æ”¿å¤§å­¦ç¬¬äºŒä½“è‚²ä¼š', '31:20.88'),
            ('æ±Ÿè—¤ å‡±æ–—', 'ä¸Šæ­¦å¤§', '31:32.99'),
            ('æ¸¡è°· æŸŠå¹³', 'æœ­å¹Œå­¦é™¢å¤§', '31:41.97'),
            ('æ¢…æœ¬ æŸŠç”Ÿ', 'ä¸Šæ­¦å¤§', 'DNF'),
            ('äº•å³¶ çœŸé¥', 'ä¸Šæ­¦å¤§', 'DNF'),
            ('ï½¶ï¾ï½³ ï¾Šï¾Ÿï¾„ï¾˜ï½¯ï½¸', 'ä¸Šæ­¦å¤§', 'DNF'),
            ('é«˜æ©‹ è¬›ä¸€éƒ', 'æœ­å¹Œå±±ã®æ‰‹é«˜', 'DNF'),
            ('éˆ´æœ¨ æµ·æ¸¡', 'æ±äº¬çµŒæ¸ˆå¤§', 'DNF'),
            ('çš†å£ å’²å¤ªæœ—', 'é–¢æ±å­¦é™¢å¤§', 'DNF'),
            ('æ‰åŸ ç«‹æ¨¹', 'ä¸Šæ­¦å¤§', 'DNS'),
            ('å¶‹ç”° å¥äºº', 'æ—¥æœ¬è–¬ç§‘å¤§', 'DNS'),
            ('å¤§åŸ æ‹“æµ·', 'æ—¥æœ¬è–¬ç§‘å¤§', 'DNS'),
            ('ä¸Šæ‰ å´‡æ–—', 'æœ­å¹Œå±±ã®æ‰‹é«˜', 'DNS'),
            ('å¢—ç”° å„ªå¤ªæœ—', 'æœ­å¹Œå±±ã®æ‰‹é«˜', 'DNS'),
            ('å®®é‡ å‹‡å¤ª', 'æœ­å¹Œå­¦é™¢å¤§', 'DNS'),
            ('å°æ¾¤ çœŸä¹ƒäº®', 'æ±äº¬çµŒæ¸ˆå¤§', 'DNS'),
            ('å°å· æµ·é‡Œ', 'åå¤å±‹å¤§', 'DNS'),
            ('åŠ è—¤ å¤ªä¸€', 'åå¤å±‹å¤§', 'DNS'),
            ('åŠ å¶‹ ç¿¼', 'æ±æ´‹å¤§', 'DNS'),
            ('é¦¬å ´ å¤§ç¿”', 'æ±æ´‹å¤§', 'DNS'),
        ],
        3: [  # 3çµ„
            ('å²©ç€¬ é§¿ä»‹', 'èŠæµ¦å·¥æ¥­å¤§', '29:29.57'),
            ('å‰åŸ è«’', 'åå¤å±‹å¤§', '29:31.03'),
            ('æ²³é‡ æ¸©å–œ', 'åŸè¥¿å¤§', '29:32.51'),
            ('æ­¦å· èˆªä¹Ÿ', 'æ±è¾²å¤§äºŒé«˜', '29:33.39'),
            ('ä½ã€…æœ¨ æ•¦å¼˜', 'é–¢æ±å­¦é™¢å¤§', '29:39.87'),
            ('å…‰å²¡ å’Œå“‰', 'æ—¥æœ¬è–¬ç§‘å¤§', '29:43.43'),
            ('ä½è—¤ æŸŠè¼”', 'æ±äº¬å›½éš›å¤§', '29:46.35'),
            ('ä¸‰é‡ è²´å²', 'æ¾æˆ¸å¸‚é™¸å”', '29:46.54'),
            ('æ£®å°» æ‚ ç¿”', 'èŠæµ¦å·¥æ¥­å¤§', '29:48.28'),
            ('å³¶å±… å„ªæˆ', 'æ—¥æœ¬è–¬ç§‘å¤§', '29:48.87'),
            ('å†…ç”° ç¿”ä¹Ÿ', 'æ±äº¬çµŒæ¸ˆå¤§', '29:49.43'),
            ('å°é‡ çœŸå’Œ', 'æ±æ´‹å¤§', '29:55.67'),
            ('æµ¦å‡º è™ä¹‹ä»‹', 'å›½å£«èˆ˜å¤§', '29:58.50'),
            ('å°æ— åœ­å¾', 'èŠæµ¦å·¥æ¥­å¤§', '29:59.78'),
            ('å¤§å³¶ å¸Œ', 'æ­¦è”µé‡å­¦é™¢å¤§', '30:09.76'),
            ('ä¹…æ…ˆ æ¸…å¤ªæœ—', 'K-project', '30:11.13'),
            ('å±±å£ æ­¦', 'ï½½ï½½ï¾ï½·', '30:12.79'),
            ('ç«¹æ— å¤§è¼', 'æ±è¾²å¤§äºŒé«˜', '30:15.19'),
            ('å°æ— æ…¶å¤ª', 'é–¢æ±å­¦é™¢å¤§', '30:16.37'),
            ('é è—¤ æ»‰å¤§', 'æ±äº¬çµŒæ¸ˆå¤§', '30:26.62'),
            ('å¾³ç”° æ„›æ–—', 'æ‹“æ®–å¤§', '30:39.58'),
            ('å¤§æ©‹ çœŸå¼¥', 'K-project', '30:42.68'),
            ('ä¸­æ‘ æ‚ æˆ', 'å›½å£«èˆ˜å¤§', '30:43.23'),
            ('æµ¦ç”° é™½è–', 'æœ­å¹Œå­¦é™¢å¤§', '30:44.98'),
            ('é…’äº• å¿ ä¹…', 'èŠæµ¦å·¥æ¥­å¤§', '30:46.49'),
            ('é»’æ¾¤ æµ·ç¾½éŸ³', 'å›½å£«èˆ˜å¤§', '31:19.50'),
            ('éˆ´æœ¨ é™½æ–—', 'å›½å£«èˆ˜å¤§', '31:22.62'),
            ('å°æ— æ­©å¤¢', 'æœ­å¹Œå­¦é™¢å¤§', '31:31.49'),
            ('åœ‹åˆ† é¥å“‰', 'å›½å£«èˆ˜å¤§', '31:35.44'),
            ('ç”°ä¸­ æ•¬', 'æ±è¾²å¤§äºŒé«˜', 'DNF'),
            ('æ£®è°· ä¿®å¹³', 'K-project', 'DNF'),
            ('å¤§æ©‹ å²ç©º', 'æœ­å¹Œå­¦é™¢å¤§', 'DNS'),
            ('ä¸­é‡ è£•å¿ƒ', 'æ‹“æ®–å¤§', 'DNS'),
            ('æ¾äº• è’¼çœŸ', 'æ‹“æ®–å¤§', 'DNS'),
            ('æŸ¿å†… å¿ƒæ¸©', 'æ‹“æ®–å¤§', 'DNS'),
            ('ä»™çŸ³ æ—­', 'å›½å£«èˆ˜å¤§', 'DNS'),
            ('é«™é‡ è€•å¤ªéƒ', 'å›½å£«èˆ˜å¤§', 'DNS'),
            ('å¤§å®‰ æ „å—£', 'å›½å£«èˆ˜å¤§', 'DNS'),
            ('æ²³åŸ å¤§å’Œ', 'æ—¥æœ¬è–¬ç§‘å¤§', 'DNS'),
        ],
    },
}


def to_katakana(name):
    """åå‰ã‹ã‚‰ã‚«ã‚¿ã‚«ãƒŠèª­ã¿ã‚’ç”Ÿæˆï¼ˆç°¡æ˜“ç‰ˆï¼‰"""
    # å®Ÿéš›ã«ã¯ãµã‚ŠãŒãªãŒå¿…è¦ã§ã™ãŒã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãªã®ã§ãƒ€ãƒŸãƒ¼
    return name.replace(' ', '')


def parse_time_to_seconds(time_str):
    """ã‚¿ã‚¤ãƒ æ–‡å­—åˆ—ã‚’ç§’ã«å¤‰æ›"""
    if time_str in ('DNS', 'DNF'):
        return None
    parts = time_str.split(':')
    if len(parts) == 2:
        minutes, seconds = parts
        return int(minutes) * 60 + float(seconds)
    return None


def get_or_create_organization(org_name):
    """å›£ä½“ã‚’å–å¾—ã¾ãŸã¯ä½œæˆ"""
    org, created = Organization.objects.get_or_create(
        name=org_name,
        defaults={
            'name_kana': org_name,  # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãªã®ã§åŒã˜å€¤
            'representative_name': 'ãƒ†ã‚¹ãƒˆä»£è¡¨è€…',
            'representative_email': f'test@{org_name.replace(" ", "")}.example.com',
            'representative_phone': '03-0000-0000',
        }
    )
    return org


def get_or_create_athlete(name, org_name, gender='M'):
    """é¸æ‰‹ã‚’å–å¾—ã¾ãŸã¯ä½œæˆ"""
    org = get_or_create_organization(org_name)
    
    # åå‰ã‚’å§“ã¨åã«åˆ†å‰²
    name_parts = name.split()
    if len(name_parts) >= 2:
        last_name = name_parts[0]
        first_name = ' '.join(name_parts[1:])
    else:
        last_name = name
        first_name = ''
    
    athlete, created = Athlete.objects.get_or_create(
        last_name=last_name,
        first_name=first_name,
        organization=org,
        defaults={
            'last_name_kana': last_name,
            'first_name_kana': first_name,
            'birth_date': date(2000, 1, 1),  # ãƒ€ãƒŸãƒ¼
            'gender': gender,
            'jaaf_id': '',
        }
    )
    return athlete


@transaction.atomic
def create_test_data():
    """ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ"""
    
    # å¤§ä¼šã‚’å–å¾—
    try:
        competition = Competition.objects.get(name='ç¬¬325å›æ—¥æœ¬ä½“è‚²å¤§å­¦é•·è·é›¢ç«¶æŠ€ä¼š')
    except Competition.DoesNotExist:
        print("âŒ å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã« create_325th_competition.py ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚")
        return
    
    print(f"ğŸ“Œ å¤§ä¼š: {competition.name}")
    print("="*60)
    
    # ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ç™»éŒ²è€…ã¨ã—ã¦å¿…è¦ï¼‰
    test_user, _ = User.objects.get_or_create(
        email='testadmin@example.com',
        defaults={
            'full_name': 'ãƒ†ã‚¹ãƒˆç®¡ç†è€…',
            'full_name_kana': 'ãƒ†ã‚¹ãƒˆã‚«ãƒ³ãƒªã‚·ãƒ£',
            'phone': '03-0000-0000',
            'is_admin': True,
            'is_staff': True,
        }
    )
    if not test_user.has_usable_password():
        test_user.set_password('testpass123')
        test_user.save()
    
    total_entries = 0
    
    for race_name, heats_data in RACE_RESULTS.items():
        print(f"\nğŸƒ {race_name}")
        
        # ç¨®ç›®ã‚’å–å¾—
        try:
            race = Race.objects.get(competition=competition, name=race_name)
        except Race.DoesNotExist:
            print(f"  âŒ ç¨®ç›® '{race_name}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            continue
        
        for heat_number, athletes_data in heats_data.items():
            print(f"  ğŸ“‹ {heat_number}çµ„ ({len(athletes_data)}å)")
            
            # çµ„ã‚’å–å¾—
            try:
                heat = Heat.objects.get(race=race, heat_number=heat_number)
            except Heat.DoesNotExist:
                print("    âŒ çµ„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
                continue
            
            # æ—¢å­˜ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¨çµ„ç·¨æˆã‚’å‰Šé™¤ï¼ˆå†å®Ÿè¡Œå¯¾å¿œï¼‰
            HeatAssignment.objects.filter(heat=heat).delete()
            Entry.objects.filter(race=race, heat_assignment__isnull=True).delete()
            
            bib_number = 1
            for athlete_name, org_name, result in athletes_data:
                # é¸æ‰‹ã‚’ä½œæˆ
                athlete = get_or_create_athlete(athlete_name, org_name, 'M')
                
                # ç”³å‘Šã‚¿ã‚¤ãƒ ã‚’çµæœã‹ã‚‰æ¨æ¸¬ï¼ˆDNF/DNSã®å ´åˆã¯ãƒ€ãƒŸãƒ¼å€¤ï¼‰
                declared_time = parse_time_to_seconds(result) or 1800  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30åˆ†
                
                # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ä½œæˆ
                entry = Entry.objects.create(
                    race=race,
                    athlete=athlete,
                    registered_by=test_user,
                    declared_time=declared_time,
                    status='confirmed',
                )
                
                # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¤å®š
                if result == 'DNS':
                    status = 'dns'
                elif result == 'DNF':
                    status = 'dnf'
                else:
                    status = 'assigned'
                
                # çµ„ç·¨æˆã‚’ä½œæˆ
                HeatAssignment.objects.create(
                    heat=heat,
                    entry=entry,
                    bib_number=bib_number,
                    status=status,
                    checked_in=status == 'assigned',  # å‡ºèµ°ã—ãŸé¸æ‰‹ã¯ç‚¹å‘¼æ¸ˆã¿
                )
                
                bib_number += 1
                total_entries += 1
    
    print("\n" + "="*60)
    print("âœ… ãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†!")
    print(f"  ç·ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°: {total_entries}")
    print("  ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼: testadmin@example.com / testpass123")


if __name__ == '__main__':
    print("="*60)
    print("ç¬¬325å›æ—¥æœ¬ä½“è‚²å¤§å­¦é•·è·é›¢ç«¶æŠ€ä¼š é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ä½œæˆ")
    print("="*60)
    create_test_data()
