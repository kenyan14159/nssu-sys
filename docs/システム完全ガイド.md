# 🏃 Nit-Sys 完全システムガイド

> **日本体育大学長距離競技会 エントリー・運営管理システム**
> 
> 陸上競技会のエントリー受付から番組編成、帳票出力まで一元管理するWebアプリケーション

---

## 📋 目次

1. [システム概要](#システム概要)
2. [技術スタック](#技術スタック)
3. [ユーザーガイド](#ユーザーガイド)
   - 団体代表者向け
   - 個人参加者向け
   - 管理者向け
4. [機能一覧](#機能一覧)
5. [データベース設計](#データベース設計)
6. [画面遷移・URL構成](#画面遷移url構成)
7. [セットアップ手順](#セットアップ手順)
8. [運用マニュアル](#運用マニュアル)
9. [トラブルシューティング](#トラブルシューティング)

---

## システム概要

### このシステムでできること

Nit-Sys（ニット・シス）は、日本体育大学で年間8回開催される長距離競技会の運営を全面的にサポートするWebシステムです。

```mermaid
flowchart LR
    subgraph 参加団体
        A[団体登録] --> B[選手マスタ登録]
        B --> C[大会エントリー]
        C --> D[振込・入金]
    end
    
    subgraph 管理者
        D --> E[入金確認]
        E --> F[番組編成]
        F --> G[帳票出力]
        G --> H[当日点呼]
    end
```

### 主な特徴

| 特徴 | 説明 |
|------|------|
| 🏢 **団体一括管理** | 大学・クラブ単位で選手を一括登録・管理 |
| 📊 **自動番組編成** | 申告タイムに基づき組分け・腰ナンバーを自動割り当て |
| 💰 **決済管理** | 振込明細画像アップロードで入金確認を効率化 |
| 📄 **帳票自動生成** | スタートリストCSV、点呼表PDF等を自動出力 |
| 🏆 **NCG対応** | NITTAI CHALLENGE GAMES の特別組編成に対応 |

---

## 技術スタック

### バックエンド

| 技術 | バージョン | 用途 |
|------|----------|------|
| **Django** | 4.2+ | Webフレームワーク |
| **Python** | 3.10+ | プログラミング言語 |
| **PostgreSQL** | 15+ | 本番データベース |
| **SQLite** | - | 開発用データベース |

### フロントエンド

| 技術 | 用途 |
|------|------|
| **Bootstrap 5** | CSSフレームワーク |
| **Bootstrap Icons** | アイコン |
| **Jazzmin** | 管理画面テーマ（AdminLTEベース） |

### 主要ライブラリ

| ライブラリ | 用途 |
|----------|------|
| `django-rest-framework` | REST API |
| `reportlab` | PDF生成 |
| `pandas` / `openpyxl` | Excel処理 |
| `django-auditlog` | 操作履歴記録 |
| `django-ratelimit` | レート制限 |
| `whitenoise` | 静的ファイル配信 |

---

## ユーザーガイド

### 👥 対象ユーザー

このシステムには3種類のユーザーがいます：

```mermaid
flowchart TD
    A[ユーザー] --> B[団体代表者]
    A --> C[個人参加者]
    A --> D[管理者]
    
    B --> B1[大学の監督・マネージャー]
    B --> B2[クラブチームの代表者]
    
    C --> C1[所属なしで参加する選手]
    
    D --> D1[日体大スタッフ]
```

---

### 🏫 団体代表者向けガイド

#### 1. 初回登録（アカウント作成）

1. **トップページにアクセス**
   - URL: `https://[ドメイン]/`
   - 「エントリーサイトへ」ボタンをクリック

2. **新規登録**
   - ログイン画面で「新規登録」リンクをクリック
   - 必要情報を入力：
     - メールアドレス（ログインID）
     - パスワード
     - 氏名・フリガナ
     - 電話番号
     - 団体分類（大学/高校/実業団/クラブ）
   - 「団体情報」セクションで団体を登録

3. **団体情報入力**

   | 項目 | 例 | 備考 |
   |------|-----|------|
   | 団体名 | 日本体育大学 | 正式名称 |
   | フリガナ | ニッポンタイイクダイガク | 全角カタカナ |
   | 略称 | 日体大 | スタートリスト表示用 |
   | 代表者氏名 | 山田 太郎 | 監督または責任者 |
   | 陸連登録コード | 東京陸協-12345 | 任意 |

#### 2. 選手マスタ登録

エントリー前に、所属選手を登録しておく必要があります。

**方法1: 個別登録**

1. サイドバー「選手管理」をクリック
2. 「新規登録」ボタン
3. 選手情報を入力：
   - 姓・名（漢字/カナ/ローマ字）
   - 性別
   - 生年月日
   - 学年（学生の場合）
   - 登録陸協（例: 東京、神奈川）
   - JAAF ID（陸連登録番号）
   - 国籍

**方法2: Excel一括登録（推奨）**

1. 「選手管理」→「一括登録」
2. 「テンプレートダウンロード」でExcelファイルを取得
3. テンプレートに沿って選手情報を入力
4. ファイルをアップロード
5. プレビューを確認して「登録」

#### 3. 大会へのエントリー

1. **ダッシュボードで大会を選択**
   - 「開催予定の大会」から大会をクリック

2. **種目を選んでエントリー**
   - 種目一覧から出場する種目を選択
   - 「エントリーする」ボタン

3. **エントリー情報入力**

   | 項目 | 説明 |
   |------|------|
   | 選手 | マスタから選択 |
   | 申告タイム | `分:秒.00` 形式（例: `14:30.00`） |
   | 自己ベスト | 参考記録 |
   | 備考 | 特記事項があれば入力 |

4. **カート確認**
   - 「エントリーカート」で全エントリーを確認
   - 誤りがあれば個別に削除可能

5. **エントリー確定**
   - 「確定して入金へ進む」をクリック
   - エントリーグループが作成される

#### 4. 入金手続き

1. **振込先情報を確認**
   - 画面に表示される振込先口座に入金

2. **振込明細をアップロード**
   - 「振込明細アップロード」ボタン
   - 振込完了画面のスクリーンショット、または振込明細書の写真を添付
   - 振込日、金額、名義を入力

3. **確認待ち**
   - 管理者が確認後、メールで通知
   - ステータスが「確定」に更新

#### 5. 駐車場申請（必要な場合）

1. 大会詳細画面から「駐車場申請」
2. 希望台数を入力：
   - 大型バス（45人以上乗り）
   - 中型バス・マイクロバス
   - 乗用車
3. 管理者が割当後、「駐車許可証PDF」がダウンロード可能

---

### 🏃 個人参加者向けガイド

個人で参加する場合は、自分自身を選手として登録します。

1. **アカウント作成**
   - 団体分類で「その他」または「クラブ」を選択
   - 所属団体略称に所属名を入力（例: 「無所属」「◯◯RC」）

2. **自分を選手として登録**
   - 選手管理から自分の情報を登録
   - 団体登録は不要

3. **エントリー・入金**
   - 団体代表者と同様の手順

---

### 🔧 管理者向けガイド

管理者は日体大の競技会運営スタッフです。

#### 管理者権限の種類

| 権限 | できること |
|------|----------|
| スタッフ権限 (`is_staff`) | Django管理画面にログイン可能 |
| 管理者権限 (`is_admin`) | 入金確認・番組編成・帳票出力が可能 |
| スーパーユーザー (`is_superuser`) | 全権限（他ユーザーの権限変更含む） |

#### 日常業務フロー

```mermaid
flowchart TD
    A[エントリー締切] --> B[入金確認]
    B --> C{全員確認済み?}
    C -->|No| B
    C -->|Yes| D[NCG処理実行]
    D --> E[組分け自動生成]
    E --> F[ゼッケン番号採番]
    F --> G[帳票出力]
    G --> H[当日点呼]
```

#### 入金確認

1. 管理画面 または **入金確認一覧**（`/payments/list/`）にアクセス
2. 「確認待ち」の入金を選択
3. 振込明細画像を確認
4. 金額・名義を照合
5. 「承認」または「却下」を選択
   - 承認：エントリーが「確定」に更新、承認メール送信
   - 却下：理由を記入、再アップロード依頼メール送信

#### 番組編成（組分け）

1. **大会選択**
   - 「番組編成」メニューから大会を選択

2. **NCG処理**（NCG種目がある場合）
   - 「全種目一括生成」ボタン
   - NCG種目の上位N名が確定、超過分は一般種目に移動

3. **組分け自動生成**
   - 種目ごとに「組分け生成」ボタン
   - 申告タイム順にソート
   - 設定された定員で自動分割

4. **手動調整**（必要な場合）
   - 同じ大学の選手を別組に分散
   - ペースメーカーの配置

5. **ゼッケン番号採番**
   - 「ゼッケン採番」ボタン
   - ルール：
     - NCG男子: 1〜499
     - NCG女子: 500〜999
     - 一般男子: 1000〜1999
     - 一般女子: 2000〜2999

#### 帳票出力

| 帳票名 | 形式 | 用途 |
|--------|------|------|
| スタートリストCSV | CSV | FinishLynx/NISHI計測連携 |
| 点呼用PDF | PDF | 当日受付でのチェック |
| プログラム原稿PDF | PDF | 大会プログラム作成 |
| 結果記録用紙PDF | PDF | 陸連公式フォーマット |
| 駐車許可証PDF | PDF | 車両掲示用 |
| 全データPDF | PDF | ネットワーク障害時バックアップ |

#### 当日点呼

1. 「当日点呼」メニューから大会選択
2. リアルタイムダッシュボードで点呼状況を確認
3. 選手検索 → チェックイン
4. 欠場者は「DNS」ボタンでマーク

#### 強制承認（トラブルデスク用）

当日現場で入金トラブルがあった場合：

1. 「強制承認」メニュー
2. 選手名で検索
3. 現場確認後、理由を記入して承認

---

## 機能一覧

### ユーザー向け機能

| 機能 | 説明 | URL |
|------|------|-----|
| ユーザー登録 | 新規アカウント作成 | `/accounts/register/` |
| ログイン | メールアドレス認証 | `/accounts/login/` |
| プロフィール | 個人情報の確認・編集 | `/accounts/profile/` |
| 選手一覧 | 所属選手の管理 | `/accounts/athletes/` |
| 選手登録 | 個別登録 | `/accounts/athletes/create/` |
| 選手一括登録 | Excel取込 | `/accounts/athletes/bulk/upload/` |
| ダッシュボード | 大会・エントリー概要 | `/competitions/dashboard/` |
| 大会一覧 | 開催予定・過去大会 | `/competitions/list/` |
| 大会詳細 | 種目・エントリー状況 | `/competitions/<pk>/` |
| エントリー作成 | 種目への申込 | `/entries/create/<comp>/<race>/` |
| エントリーカート | 未確定エントリー確認 | `/entries/cart/<comp>/` |
| 振込アップロード | 入金確認依頼 | `/payments/upload/<group>/` |
| 駐車場申請 | 車両駐車の事前申請 | `/payments/parking/<comp>/` |
| 領収書ダウンロード | 入金確認後 | `/payments/receipt/<group>/` |

### 管理者向け機能

| 機能 | 説明 | URL |
|------|------|-----|
| 入金確認一覧 | 振込明細の確認・承認 | `/payments/list/` |
| 強制承認 | トラブルデスク用 | `/payments/force-approve/` |
| 番組編成 | 組分け管理 | `/heats/management/<comp>/` |
| 組一覧 | 種目ごとの組確認 | `/heats/list/<race>/` |
| 点呼ダッシュボード | リアルタイム点呼状況 | `/heats/checkin/<comp>/dashboard/` |
| 帳票出力メニュー | 各種帳票のダウンロード | `/reports/<comp>/` |
| お知らせ管理 | 緊急情報の掲載 | `/admin/news/` |

### Django管理画面

URL: `/admin/`

Jazzminテーマによるモダンな管理画面を提供。

| アプリ名 | 管理対象 |
|---------|---------|
| ユーザー管理 | ユーザー、団体、選手 |
| 大会・種目 | 大会、種目、組、組編成 |
| エントリー | エントリー、エントリーグループ |
| 入金管理 | 入金、振込先口座、駐車場申請 |
| レポート | 帳票出力ログ |
| お知らせ | お知らせ記事 |
| 操作履歴 | 全データ変更履歴 |

---

## データベース設計

### ER図

```mermaid
erDiagram
    User ||--o{ Athlete : "登録"
    User }o--|| Organization : "所属"
    Organization ||--o{ Athlete : "所属"
    
    Competition ||--o{ Race : "開催"
    Race ||--o{ Entry : "エントリー"
    Athlete ||--o{ Entry : "出場"
    User ||--o{ Entry : "申込者"
    
    EntryGroup ||--o{ Entry : "含む"
    EntryGroup ||--|| Payment : "支払い"
    Organization ||--o{ EntryGroup : "団体"
    Competition ||--o{ EntryGroup : "大会"
    
    Race ||--o{ Heat : "組分け"
    Heat ||--o{ HeatAssignment : "編成"
    Entry ||--|| HeatAssignment : "割当"
    
    Organization ||--o{ ParkingRequest : "申請"
    Competition ||--o{ ParkingRequest : "大会"
```

### 主要モデル詳細

#### User（ユーザー）

```python
class User(AbstractUser):
    email           # メールアドレス（ログインID）
    full_name       # 氏名
    full_name_kana  # フリガナ
    phone           # 電話番号
    organization_type  # 団体分類
    organization    # 所属団体（FK）
    is_admin        # 管理者フラグ
    is_individual   # 個人参加フラグ
```

#### Organization（団体）

```python
class Organization:
    name             # 団体名
    name_kana        # フリガナ
    short_name       # 略称
    representative_name   # 代表者氏名
    representative_email  # 代表者メール
    representative_phone  # 代表者電話
    jaaf_code        # 陸連登録コード
```

#### Athlete（選手）

```python
class Athlete:
    organization    # 所属団体（FK）
    user            # 登録ユーザー（FK）
    last_name       # 姓
    first_name      # 名
    last_name_kana  # セイ
    first_name_kana # メイ
    last_name_en    # FAMILY NAME
    first_name_en   # Given name
    gender          # 性別（M/F）
    birth_date      # 生年月日
    grade           # 学年
    registered_pref # 登録陸協
    jaaf_id         # JAAF ID
    nationality     # 国籍（IOC 3文字コード）
```

#### Competition（大会）

```python
class Competition:
    name            # 大会名
    description     # 説明
    event_date      # 開催日（初日）
    event_end_date  # 開催日（最終日）
    venue           # 会場
    entry_start_at  # エントリー開始日時
    entry_end_at    # エントリー締切日時
    entry_fee       # 参加費
    default_heat_capacity  # 1組定員
    is_published    # 公開フラグ
    is_entry_open   # エントリー受付中フラグ
```

#### Race（種目）

```python
class Race:
    competition     # 大会（FK）
    distance        # 距離（800/1500/3000/5000/10000m）
    gender          # 性別区分（M/F/X）
    name            # 種目名
    heat_capacity   # 1組定員
    max_entries     # エントリー上限
    is_ncg          # NCG種目フラグ
    ncg_capacity    # NCG定員
    standard_time   # 参加標準記録（秒）
    fallback_race   # 一般種目（NCG溢れ移動先）
```

#### Entry（エントリー）

```python
class Entry:
    athlete         # 選手（FK）
    race            # 種目（FK）
    registered_by   # 申込者（FK）
    declared_time   # 申告タイム（秒）
    personal_best   # 自己ベスト（秒）
    status          # ステータス
    moved_from_ncg  # NCGから移動フラグ
    original_ncg_race  # 元NCG種目（FK）
```

**ステータス遷移:**

```mermaid
stateDiagram-v2
    [*] --> pending: エントリー申込
    pending --> payment_uploaded: 振込明細アップロード
    payment_uploaded --> confirmed: 管理者承認
    payment_uploaded --> pending: 管理者却下
    confirmed --> dns: 当日欠場
    pending --> cancelled: ユーザーキャンセル
```

#### Heat（組）

```python
class Heat:
    race            # 種目（FK）
    heat_number     # 組番号
    scheduled_start_time  # 開始予定時刻
    is_finalized    # 確定済みフラグ
```

#### HeatAssignment（組編成）

```python
class HeatAssignment:
    heat            # 組（FK）
    entry           # エントリー（FK）
    bib_number      # 腰ナンバー（組内連番）
    race_bib_number # ゼッケン番号（大会通し番号）
    status          # ステータス（assigned/dns/dnf/dq）
    checked_in      # 点呼済みフラグ
```

---

## 画面遷移・URL構成

### アプリケーション構成

```
nit-sys/
├── nitsys/          # プロジェクト設定
├── accounts/        # ユーザー・団体・選手
├── competitions/    # 大会・種目
├── entries/         # エントリー
├── payments/        # 決済・駐車場
├── heats/           # 番組編成・点呼
├── reports/         # 帳票出力
├── news/            # お知らせ
└── templates/       # HTMLテンプレート
```

### URL一覧

#### トップレベル

| URL | ビュー | 説明 |
|-----|-------|------|
| `/` | `index_view` | トップページ（未ログイン時） |
| `/admin/` | Django Admin | 管理画面 |
| `/admin/guide/` | `admin_guide_view` | 管理者ガイド |

#### accounts（認証・ユーザー管理）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/accounts/login/` | `CustomLoginView` | ログイン |
| `/accounts/logout/` | `CustomLogoutView` | ログアウト |
| `/accounts/register/` | `register` | 新規登録 |
| `/accounts/profile/` | `profile` | プロフィール表示 |
| `/accounts/profile/edit/` | `profile_edit` | プロフィール編集 |
| `/accounts/athletes/` | `athlete_list` | 選手一覧 |
| `/accounts/athletes/create/` | `athlete_create` | 選手登録 |
| `/accounts/athletes/<pk>/edit/` | `athlete_edit` | 選手編集 |
| `/accounts/athletes/<pk>/delete/` | `athlete_delete` | 選手削除 |
| `/accounts/athletes/bulk/template/` | `athlete_bulk_template` | テンプレートDL |
| `/accounts/athletes/bulk/upload/` | `athlete_bulk_upload` | 一括アップロード |
| `/accounts/password_reset/` | Django組込 | パスワードリセット |

#### competitions（大会）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/competitions/dashboard/` | `dashboard` | ダッシュボード |
| `/competitions/list/` | `competition_list` | 大会一覧 |
| `/competitions/<pk>/` | `competition_detail` | 大会詳細 |
| `/competitions/history/` | `entry_history` | エントリー履歴 |

#### entries（エントリー）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/entries/create/<comp>/<race>/` | `entry_create` | エントリー作成 |
| `/entries/cart/<comp>/` | `entry_cart` | カート確認 |
| `/entries/<pk>/` | `entry_detail` | エントリー詳細 |
| `/entries/<pk>/delete/` | `entry_delete` | エントリー削除 |
| `/entries/confirm/<comp>/` | `entry_confirm` | 確定・決済へ |
| `/entries/excel/template/<comp>/` | `excel_template_download` | Excelテンプレート |
| `/entries/excel/upload/<comp>/` | `excel_upload` | Excel一括登録 |

#### payments（決済・駐車場）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/payments/upload/<group>/` | `payment_upload` | 振込アップロード |
| `/payments/status/<group>/` | `payment_status` | 支払い状況 |
| `/payments/list/` | `payment_list` | 入金確認一覧（管理者） |
| `/payments/review/<pk>/` | `payment_review` | 入金確認（管理者） |
| `/payments/force-approve/<comp>/` | `force_approve_search` | 強制承認検索 |
| `/payments/parking/<comp>/` | `parking_request_view` | 駐車場申請 |
| `/payments/parking/permit/<pk>/` | `parking_permit_download` | 許可証DL |
| `/payments/receipt/<group>/` | `receipt_download` | 領収書DL |

#### heats（番組編成・点呼）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/heats/management/<comp>/` | `heat_management` | 番組編成管理 |
| `/heats/list/<race>/` | `heat_list` | 組一覧 |
| `/heats/generate/<race>/` | `generate_heats` | 組分け生成 |
| `/heats/<pk>/` | `heat_detail` | 組詳細 |
| `/heats/api/move/` | `move_assignment` | 選手移動API |
| `/heats/finalize/<pk>/` | `finalize_heat` | 組確定 |
| `/heats/checkin/<comp>/` | `checkin_search` | 点呼検索 |
| `/heats/checkin/<comp>/dashboard/` | `checkin_dashboard` | 点呼ダッシュボード |
| `/heats/checkin/in/<pk>/` | `checkin` | チェックイン |
| `/heats/dns/<pk>/` | `mark_dns` | DNSマーク |
| `/heats/generate-all/<comp>/` | `generate_all_heats` | 全種目一括生成 |
| `/heats/assign-bibs/<comp>/` | `assign_bib_numbers` | ゼッケン採番 |

#### reports（帳票）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/reports/<comp>/` | `report_index` | 帳票メニュー |
| `/reports/startlist/<race>/` | `download_startlist_csv` | スタートリストCSV |
| `/reports/all-data/<comp>/csv/` | `download_all_data_csv` | 全データCSV |
| `/reports/rollcall/<heat>/` | `download_rollcall_pdf` | 点呼用PDF |
| `/reports/program/<race>/` | `download_program_pdf` | プログラムPDF |
| `/reports/all-data/<comp>/pdf/` | `download_all_data_pdf` | 全データPDF |
| `/reports/result-sheet/<heat>/` | `download_result_sheet_pdf` | 結果用紙PDF |

#### news（お知らせ）

| URL | ビュー | 説明 |
|-----|-------|------|
| `/news/` | `news_list` | お知らせ一覧 |
| `/news/<pk>/` | `news_detail` | お知らせ詳細 |

#### API

| URL | メソッド | 説明 |
|-----|---------|------|
| `/api/athletes/` | GET | 選手一覧API |
| `/api/athletes/<id>/` | GET | 選手詳細API |
| `/api/entries/` | GET, POST | エントリーAPI |

---

## セットアップ手順

### 前提条件

- Python 3.10以上
- PostgreSQL 15以上（本番環境、開発時はSQLiteでも可）
- Git

### 開発環境セットアップ

```bash
# 1. リポジトリクローン
git clone https://github.com/yourusername/nit-sys.git
cd nit-sys

# 2. 仮想環境作成
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. 依存パッケージインストール
pip install -r requirements.txt

# 4. 環境変数設定
cp .env.example .env
# .env を編集：
#   - SECRET_KEY を生成（Django公式のシークレットキー生成器を使用）
#   - USE_SQLITE=True を設定（開発環境の場合）
#   - DEBUG=True を設定

# 5. マイグレーション
python manage.py migrate

# 6. 管理者作成
python manage.py createsuperuser

# 7. 開発サーバー起動
python manage.py runserver
```

ブラウザで `http://localhost:8000` にアクセス。

### 環境変数

`.env` ファイルに設定する環境変数：

| 変数名 | 説明 | 例 |
|-------|------|-----|
| `SECRET_KEY` | Django秘密鍵 | 50文字以上のランダム文字列 |
| `DEBUG` | デバッグモード | `True` / `False` |
| `ALLOWED_HOSTS` | 許可ホスト | `localhost,127.0.0.1` |
| `USE_SQLITE` | SQLite使用 | `True` / `False` |
| `DATABASE_URL` | PostgreSQL URL | `postgres://user:pass@host:5432/db` |
| `EMAIL_HOST` | SMTPホスト | `smtp.gmail.com` |
| `EMAIL_HOST_USER` | 送信元メールアドレス | `example@gmail.com` |
| `EMAIL_HOST_PASSWORD` | アプリパスワード | Gmailの場合はアプリパスワード |

### 本番デプロイ（Render）

1. GitHubにpush
2. Renderで「New Web Service」作成
3. `render.yaml` Blueprint使用
4. 環境変数を設定
5. デプロイ完了後、管理者作成：
   ```bash
   render exec python manage.py createsuperuser
   ```

---

## 運用マニュアル

### 大会開催前（1〜2週間前）

1. **大会登録**
   - Django管理画面で新規大会を作成
   - 種目を登録（NCG種目にはフラグ設定）
   - 参加標準記録を設定（必要な場合）
   - エントリー期間を設定
   - `is_published = True` で公開

2. **振込先口座確認**
   - 管理画面で振込先口座が正しいか確認

### エントリー期間中

1. **入金確認業務**
   - 毎日、入金確認一覧をチェック
   - 振込明細を照合して承認/却下
   - 問い合わせ対応

2. **お知らせ更新**
   - 重要なお知らせは「重要」フラグをON
   - 緊急時は「緊急」カテゴリを使用

### エントリー締切後

1. **NCG処理**
   - 「全種目一括生成」を実行
   - NCG定員超過者が自動的に一般種目へ移動

2. **組分け生成**
   - 各種目で組分けを生成
   - 必要に応じて手動調整

3. **ゼッケン番号採番**
   - 大会全体で一括採番

4. **帳票出力**
   - スタートリストCSVを計測システムに取り込み
   - 点呼表PDFを印刷
   - プログラム原稿PDF作成

5. **駐車場割当**
   - 駐車場申請CSVをエクスポート
   - 割当結果をCSVインポート
   - 駐車許可証PDF一括出力

### 大会当日

1. **点呼業務**
   - 点呼ダッシュボードでリアルタイム確認
   - 選手検索してチェックイン
   - 欠場者はDNSマーク

2. **トラブル対応**
   - 未入金者には強制承認（現場確認後）
   - 結果記録用紙PDFを適宜出力

3. **緊急バックアップ**
   - ネットワーク障害時は「全データPDF」を使用

---

## トラブルシューティング

### よくある問題と解決策

#### ログインできない

1. **メールアドレス間違い**
   - 登録時のメールアドレスを確認

2. **パスワード忘れ**
   - 「パスワードを忘れた方」からリセット

3. **レート制限**
   - 5回/分超過でブロック
   - 1分待ってから再試行

#### エントリーできない

1. **エントリー期間外**
   - 開始日時・締切日時を確認

2. **定員オーバー**
   - 他の組に空きがあるか確認

3. **標準記録未達**
   - NCG種目は標準記録が必要
   - 一般種目へのエントリーを検討

#### 振込明細がアップロードできない

1. **ファイルサイズ超過**
   - 5MB以下にリサイズ

2. **対応形式外**
   - JPEG, PNG, GIF, WebP, PDF のみ対応

#### 組分けが生成されない

1. **確定エントリーがない**
   - 入金確認が完了しているか確認

2. **既存の組がある**
   - 「再生成」オプションをON

### 緊急時の対応

#### サーバーダウン

1. Renderダッシュボードでサービス状態確認
2. ログを確認
3. 必要に応じて再デプロイ

#### データ復旧

1. PostgreSQLのバックアップから復旧
2. Renderの自動バックアップを使用

---

## 付録

### キーボードショートカット

| ショートカット | 動作 |
|---------------|------|
| `G` + `D` | ダッシュボードへ移動 |
| `G` + `A` | 選手管理へ移動 |
| `G` + `C` | 大会一覧へ移動 |
| `G` + `H` | エントリー履歴へ移動 |

### スタートリストCSV形式

FinishLynx連携用CSVフォーマット：

```csv
種目,組,腰ナンバー,ゼッケン,氏名,フリガナ,所属,申告タイム
男子5000m,1,1,1001,山田 太郎,ヤマダ タロウ,日体大,14:30.00
```

### セキュリティ設定

- **セッションタイムアウト**: アイドル30分、絶対24時間
- **レート制限**: ログイン 5回/分
- **CSRF保護**: 全POSTリクエスト
- **XSS対策**: Django標準エスケープ
- **監査ログ**: 全データ変更を記録

---

*最終更新: 2025年12月*
*バージョン: 1.0.0*

