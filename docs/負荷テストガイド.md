# 負荷テストガイド

Locustを使用した負荷テストの実施手順です。

---

## クイックスタート

```bash
# 開発サーバーを起動（別ターミナル）
python manage.py runserver

# Locustを起動
cd /path/to/nit-sys
locust -f scripts/locustfile.py --host=http://localhost:8000

# ブラウザで http://localhost:8089 を開く
```

---

## 推奨設定

| シナリオ | ユーザー数 | スポーンレート | 用途 |
|----------|-----------|---------------|------|
| **小規模** | 50 | 5/秒 | 基本動作確認 |
| **中規模** | 200 | 10/秒 | 通常運用想定 |
| **大規模** | 500 | 20/秒 | エントリー開始時のスパイク想定 |

---

## テストユーザータイプ

| タイプ | 重み | 行動 |
|--------|------|------|
| `WebsiteUser` | 10 | トップページ、大会一覧閲覧 |
| `AdminUser` | 1 | 管理画面操作 |
| `EntryFlowUser` | 2 | エントリーフロー |

---

## 本番環境テスト

> [!CAUTION]
> 本番環境でのテストは、低負荷設定で実施してください。

```bash
locust -f scripts/locustfile.py --host=https://your-app.onrender.com
```

---

## 結果の見方

| メトリクス | 目標値 | 説明 |
|-----------|--------|------|
| **Median** | < 500ms | 中央値レスポンス時間 |
| **95%ile** | < 2000ms | 95%のリクエスト |
| **Failures** | 0% | エラー率 |

---

## トラブルシューティング

### レスポンスが遅い場合

1. データベースクエリの最適化（select_related/prefetch_related）
2. キャッシュの導入
3. Renderプランのスケールアップ

### メモリ不足エラー

1. Renderダッシュボードでメモリ使用量を確認
2. 必要に応じてプランをアップグレード
